@let url = kcContext.url;
@let otpLogin = kcContext.otpLogin;
@let messagesPerField = kcContext.messagesPerField;

<ng-template #headerNode>
  <div class="leading-tight tracking-tight flex flex-col mb-2">
    <span class="text-2xl font-bold">{{ i18n.msgStr('doLogIn') }}</span>
  </div>
</ng-template>

<div
  id="kc-form"
  class="mt-6"
>
  <div id="kc-form-wrapper">
    <form
      id="kc-otp-login-form"
      method="post"
      class="space-y-5!"
      [action]="url.loginAction"
    >
      @if (otpLogin.userOtpCredentials.length > 1) {
        <div class="space-y-3">
          <label class="text-sm font-medium text-gray-700 mb-3 block">
            {{ i18n.msgStr('loginChooseAuthenticator') }}
          </label>
          <mat-radio-group
            name="selectedCredentialId"
            class="flex flex-col space-y-2"
            [value]="otpLogin.selectedCredentialId"
          >
            @for (otpCredential of otpLogin.userOtpCredentials; track otpCredential; let i = $index) {
              <mat-radio-button
                [id]="'kc-otp-credential-' + i"
                [value]="otpCredential.id"
                class="w-full"
              >
                <div class="flex items-center space-x-2 w-full">
                  <mat-icon
                    class="icon-size-5"
                    [svgIcon]="'heroicons_solid:device-phone-mobile'"
                  ></mat-icon>
                  <span class="font-medium">{{ otpCredential.userLabel }}</span>
                </div>
              </mat-radio-button>
            }
          </mat-radio-group>
        </div>
      }

      <div>
        <mat-form-field
          appearance="outline"
          class="w-full"
          [ngClass]="{
            'mat-form-field-invalid! ng-invalid!': messagesPerField.existsError('totp'),
          }"
        >
          <mat-label for="otp">
            {{ i18n.msgStr('loginOtpOneTime') }}
          </mat-label>
          <input
            matInput
            id="otp"
            name="otp"
            type="text"
            autocomplete="off"
            autofocus
            maxlength="6"
            placeholder="000000"
            [attr.aria-invalid]="messagesPerField.existsError('totp')"
          />
          <mat-icon
            matSuffix
            class="icon-size-5 text-gray-400"
            [svgIcon]="'heroicons_solid:shield-check'"
          ></mat-icon>
          @if (messagesPerField.existsError('totp')) {
            <mat-hint class="text-error">
              {{ messagesPerField.get('totp') }}
            </mat-hint>
          }
        </mat-form-field>
      </div>

      <div class="space-y-4">
        <button
          name="login"
          id="kc-login"
          type="submit"
          matButton="filled"
          class="w-full"
        >
          {{ i18n.msgStr('doLogIn') }}
        </button>
      </div>
    </form>
  </div>
</div>
