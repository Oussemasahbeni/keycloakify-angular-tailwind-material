@let recoveryAuthnCodesConfigBean = kcContext.recoveryAuthnCodesConfigBean;
@let isAppInitiatedAction = kcContext.isAppInitiatedAction;

<ng-template #headerNode>
  <div class="leading-tight tracking-tight mb-4">
    <span class="text-lg font-bold">{{ i18n.msgStr('recovery-code-config-header') }}</span>
  </div>
</ng-template>

<div class="space-y-6">
  <kc-alert
    [appearance]="'outline'"
    type="info"
  >
    <h3 class="text-sm font-medium">
      {{ i18n.msgStr('recovery-code-config-warning-title') }}
    </h3>
    <div class="mt-2 text-sm">
      <p>{{ i18n.msgStr('recovery-code-config-warning-message') }}</p>
    </div>
  </kc-alert>

  <div class="bg-surface-container rounded-lg p-6">
    <ol
      [id]="olRecoveryCodesListId"
      class="grid grid-cols-1 sm:grid-cols-2 gap-3"
    >
      @for (code of recoveryAuthnCodesConfigBean.generatedRecoveryAuthnCodesList; track code; let i = $index) {
        <li class="bg-surface-container-lowest p-3 rounded border font-mono text-sm flex items-center gap-2">
          <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-bold min-w-[24px] text-center">
            {{ i + 1 }}
          </span>
          <span class="font-medium"> {{ code.slice(0, 4) }}-{{ code.slice(4, 8) }}-{{ code.slice(8) }} </span>
        </li>
      }
    </ol>
  </div>

  <!-- actions -->

  <div class="flex flex-col sm:flex-row gap-3">
    <button
      matButton="outlined"
      id="printRecoveryCodes"
      type="button"
      class="flex-1"
    >
      <mat-icon class="mr-2">print</mat-icon>
      {{ i18n.msgStr('recovery-codes-print') }}
    </button>

    <button
      matButton="outlined"
      id="downloadRecoveryCodes"
      type="button"
      class="flex-1"
    >
      <mat-icon class="mr-2">download</mat-icon>
      {{ i18n.msgStr('recovery-codes-download') }}
    </button>

    <button
      matButton="outlined"
      id="copyRecoveryCodes"
      type="button"
      class="flex-1"
    >
      <mat-icon class="mr-2">content_copy</mat-icon>
      {{ i18n.msgStr('recovery-codes-copy') }}
    </button>
  </div>

  <div>
    <mat-checkbox
      id="kcRecoveryCodesConfirmationCheck"
      name="kcRecoveryCodesConfirmationCheck"
      [checked]="toggleRecoveryCodesConfirmation()"
      (change)="onCheckboxChange($event)"
      class="w-full"
    >
      <span class="text-sm">
        {{ i18n.msgStr('recovery-codes-confirmation-message') }}
      </span>
    </mat-checkbox>

    <kc-logout-other-sessions />
  </div>

  <form
    id="kc-recovery-codes-settings-form"
    method="post"
    [action]="kcContext.url.loginAction"
  >
    <input
      type="hidden"
      name="generatedRecoveryAuthnCodes"
      [value]="recoveryAuthnCodesConfigBean.generatedRecoveryAuthnCodesAsString"
    />
    <input
      type="hidden"
      name="generatedAt"
      [value]="recoveryAuthnCodesConfigBean.generatedAt"
    />
    <input
      type="hidden"
      id="userLabel"
      name="userLabel"
      [value]="i18n.msgStr('recovery-codes-label-default')"
    />

    @if (isAppInitiatedAction) {
      <button
        matButton="filled"
        type="submit"
        id="saveRecoveryAuthnCodesBtn"
        [disabled]="!toggleRecoveryCodesConfirmation()"
        class="flex-1"
      >
        {{ i18n.msgStr('recovery-codes-action-complete') }}
      </button>

      <button
        matButton="outlined"
        type="submit"
        id="cancelRecoveryAuthnCodesBtn"
        name="cancel-aia"
        value="true"
        class="flex-1 outline-button-error"
      >
        {{ i18n.msgStr('recovery-codes-action-cancel') }}
      </button>
    } @else {
      <button
        matButton="filled"
        type="submit"
        id="saveRecoveryAuthnCodesBtn"
        [disabled]="!toggleRecoveryCodesConfirmation()"
        class="w-full"
      >
        {{ i18n.msgStr('recovery-codes-action-complete') }}
      </button>
    }
  </form>
</div>
