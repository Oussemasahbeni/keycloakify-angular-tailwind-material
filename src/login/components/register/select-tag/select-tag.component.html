@let attr = attribute();
@let multiple = isMultiple();
@if (attr) {
  <mat-form-field
    class="w-full"
    appearance="outline"
  >
    <mat-label>
      {{ i18n.advancedMsgStr(attr.displayName ?? '') }}
      @if (attr.required) {
        *
      }
    </mat-label>
    <mat-select
      [id]="attr.name"
      [name]="attr.name"
      [value]="valueOrValues()"
      [attr.aria-invalid]="!!displayableErrors()?.length"
      [disabled]="attr.readOnly"
      [multiple]="multiple"
      (selectionChange)="onChange($event)"
      (blur)="onBlur()"
    >
      @if (!multiple) {
        <mat-option value=""></mat-option>
      }
      @for (option of options(); track option) {
        <mat-option [value]="option">
          @if (!!attr.annotations.inputOptionLabels) {
            {{ i18n.advancedMsgStr(attr.annotations.inputOptionLabels[option] ?? option) }}
          } @else if (!!attr.annotations.inputOptionLabelsI18nPrefix) {
            {{ i18n.advancedMsgStr(attr.annotations.inputOptionLabelsI18nPrefix + '.' + option) }}
          } @else {
            {{ option }}
          }
        </mat-option>
      }
    </mat-select>

    @for (error of displayableErrors(); track error; let i = $index) {
      <!-- {{ error.fieldIndex }} - {{ index }}
      @if (error.fieldIndex === index) {
        <mat-hint class="text-error">
          {{ error.errorMessageStr }}
        </mat-hint>
      } -->
      <mat-hint class="text-error">
        {{ error.errorMessageStr }}
      </mat-hint>
    }

    <!-- Hidden inputs so Keycloak receives the field by name on submit -->
    <input
      type="hidden"
      [name]="attr.name"
      [value]="valueOrValues"
    />
  </mat-form-field>
}
